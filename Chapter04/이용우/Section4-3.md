# Chapter 4 DataBase(데이터베이스)

# Section 4.3 트랜잭션과 무결성

## Transaction(트랜잭션)

> 💡 Transaction(트랜잭션)은 데이터베이스에서 하나의 논리적인 기능을 수행하기 위한 작업의 단위를 뜻하고, 여러개의 쿼리들을 하나로 묶어 사용하는 것을 뜻합니다.
>

## 📌 원자성(Atomicity)

> 💡 원자성(Atomicity)은 트랜잭션과 관련된 일이 모두 수행되거나, 아니면 전혀 수행되지 않아야 한다는 것을 의미합니다.
>
트랜잭션의 기본적인 개념은 원자성에서 나타나게 되었습니다.

### COMMIT과 ROLLBACK

> 💡 COMMIT(커밋)은 트랜잭션에서 수행한 여러가지의 쿼리가 성공적으로 처리되었다고 확정하는 명령어입니다.
> 커밋은 트랜잭션 단위로 수행되며, 작업된 내용이 데이터베이스에 영구적으로 반영되는 것을 뜻합니다.
>


> 💡 ROLLBACK(롤백)은 트랜잭션에서 수행한 여러가지의 쿼리를 데이터베이스에 반영하지 않고, 트랜잭션이 시작된 상태로 되돌리는 것(취소)을 뜻합니다.
>
커밋과 롤백이라는 개념으로 인해, 원자성이라는 특징을 지킬 수 있게 되고, 데이터의 무결성이 보장되게 됩니다.

### 트랜잭션의 전파

트랜잭션은 하나의 커넥션(Connection)단위로 작업을 수행하기 때문에, 데이터베이스와 연결된 커넥션 객체를 전달하여 작업을 수행합니다.  
하지만, 매번 **트랜잭션 커넥션**을 생성하고, 작업을 수행한 후에 커넥션을 닫는 것은 매우 비효율적인 작업입니다.  
이러한 상황을 해결하기 위해, 스프링에서는 **트랜잭션의 전파**를 지원합니다.

``` java
@Service
@Transactional(readOnly = true)
public class MemberService {
  private final MemberRepository memberRepositoryl
  
  public MemberService(MemberRepository memberRepository) {
    this.memberRepository = memberRepository;
  }
}
```

위와 같이 스프링에서는 `@Transactional` Annotation을 이용해 여러개의 쿼리를 하나의 트랜잭션으로 처리할 수 있게 됩니다.

## 📌 일관성(Consistency)

> 💡 일관성(Consistency)은 트랜잭션이 성공적으로 완료되면, 데이터베이스는 일관성 있는 상태로 유지되어야 한다는 것을 의미합니다.
>
만약 데이터베이스 작업을 처리하던 중 오류가 발생하게 되어 생각지도 못한 데이터가 데이터베이스에 반영되어 있을 경우, 원하는 상태로 데이터를 복구하기 위해 더욱 많은 일을 수행해야할 수도 있기 때문입니다.

## 📌 격리성(Isolation)

> 💡 격리성(Isolation)은 트랜잭션들이 동시에 실행되고 있을 때, 각각의 트랜잭션은 서로 간섭 없이 독립적으로 수행되어야 한다는 것을 의미합니다.
>

### 격리 수준(Isolation Level)

> 💡 격리 수준(Isolation Level)은 동시성과 격리성을 어느 정도로 보장할 것인지를 결정하는 수준을 의미합니다.
>

격리 수준은 동시성과 격리성 중 어느 것을 더 중요시 할 것인지에 따라 다르게 설정할 수 있습니다.

- `READ_UNCOMMITTED`(읽기 미커밋)
- `READ_COMMITTED`(읽기 커밋)
- `REPEATABLE_READ`(반복 읽기)
- `SERIALIZABLE`(직렬화)

## 📌 지속성(Durability)

> 💡 지속성(Durability)은 트랜잭션이 성공적으로 완료되면, 그 결과는 데이터베이스에 영구적으로 반영되어야 한다는 것을 의미합니다.
>
만약, 데이터베이스에 장애가 발생하더라도 원래 상태로 복구하기 위해 회복 기능을 지원해야한다는 것을 뜻하며, 이를 위해 데이터베이스는 체크섬과 롤백과 같은 기능을 지원하게됩니다.

## 📌 무결성(Integrity)

> 💡 무결성(Integrity)은 데이터의 정확성 일관성, 유효성을 유지하는 것을 뜻하며, 무결성이 유지되어야 데이터베이스에 저장된 데이터를 신뢰할 수 있게 될 것입니다.
>

- 개체 무결성(Entity Integrity)
    - 개체 무결성은 테이블의 기본키(Primary Key)는 NULL 값을 가질 수 없으며, 중복된 값을 가질 수 없다는 것을 의미합니다.
- 참조 무결성(Referential Integrity)
    - 참조 무결성은 외래키(Foreign Key)는 NULL 값을 가질 수 없으며, 참조하는 테이블의 기본키(Primary Key) 값이 존재해야 한다는 것을 의미합니다.
- 고유 무결성(Unique Integrity)
    - 고유 무결성은 테이블의 컬럼이 고유한 값을 가지도록 설정한 경우, 해당하는 컬럼은 모두 고유한 값을 가져야한다는 것을 의미합니다.
- NULL 무결성(Null Integrity)
    - NULL 무결성은 테이블의 컬럼이 NULL을 허용하지 않는다는 조건이 주어진 경우, 해당하는 컬럼은 NULL 값을 가질 수 없다는 것을 의미합니다. 
